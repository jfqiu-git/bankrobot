#include "depthimage_to_laserscan.h"

bool depthimage_to_laserscan::use_point(const float new_value, const float old_value, const float range_min, const float range_max)
{  
	// Check for NaNs and Infs, a real number within our limits is more desirable than these.
	bool new_finite = std::isfinite(new_value);
	bool old_finite = std::isfinite(old_value);

	// Infs are preferable over NaNs (more information)
	if (!new_finite && !old_finite) // Both are not NaN or Inf.
	{ 
		if (!isnan(new_value)) // new is not NaN, so use it's +-Inf value.
		{ 
			return true;
		}
		return false; // Do not replace old_value
	}

	// If not in range, don't bother
	bool range_check = range_min <= new_value && new_value <= range_max;
	if (!range_check)
	{
		return false;
	}

	if (!old_finite) // New value is in range and finite, use it.
	{ 
		return true;
	}

	// Finally, if they are both numerical and new_value is closer than old_value, use new_value.
	bool shorter_check = new_value < old_value;
	return shorter_check;
}
